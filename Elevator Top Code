LIBRARY IEEE;
USE IEEE.STD_LOGIC_1164.ALL;
USE IEEE.NUMERIC_STD.ALL;

ENTITY ElevatorTop IS
    PORT(
        CLOCK_50 : in  STD_LOGIC;
        KEY : in  STD_LOGIC_VECTOR(3 downto 0);
        SW : in  STD_LOGIC_VECTOR(9 downto 0); 
        HEX0 : out STD_LOGIC_VECTOR(6 downto 0);
        LEDR : out STD_LOGIC_VECTOR(9 downto 0)
    );
END ElevatorTop;

ARCHITECTURE Behavioral of ElevatorTop IS

    signal TickWire : std_logic;
    signal CurrFloorWire : integer range 0 to 4;
    signal DoorWire, UpWire, DownWire : std_logic;
    signal HardResetWire, SoftResetWire : std_logic;
    signal Debug : std_logic_vector(2 downto 0);

BEGIN
    HardResetWire <= not KEY(0);
    SoftResetWire <= not KEY(1);

    U1_CLK: entity work.ClockDivider
        generic map (MAX_COUNT => 50000000)
        port map (
            clk => CLOCK_50,
            reset => HardResetWire,
            tick => TickWire
        );

    -- Instantiate Controller
    U2_CTRL: entity work.ElevatorController
        port map (
            clk => CLOCK_50,
            HardReset => HardResetWire,
            SoftReset => SoftResetWire,
            estop => SW(9),
            tick => TickWire,
            ReqButtons => SW(3 downto 0), 
            CurrentFloor => CurrFloorWire,
            DoorOpen => DoorWire,
            MovingUp => UpWire,
            MovingDown => DownWire,
            debugger => Debug
        );

    -- Instantiate Display
    U3_DISP: entity work.SegDecoder
        port map(
            Floor => CurrFloorWire,
            HexOut => HEX0
        );
    
    -- System Status
    LEDR(0) <= DoorWire; -- ON when Door is OPEN
    LEDR(1) <= UpWire;   -- ON when Moving UP
    LEDR(2) <= DownWire; -- ON when Moving DOWN
    
    LEDR(3) <= SW(0); 
    LEDR(4) <= SW(1); 
    LEDR(5) <= SW(2); 
    LEDR(6) <= SW(3); 
    
    -- Unused LEDs (Optional: Map debug state or force to 0)
    LEDR(7) <= '0';
    LEDR(8) <= '0';
    
    -- ESTOP Status
    LEDR(9) <= SW(9); 

END Behavioral;
