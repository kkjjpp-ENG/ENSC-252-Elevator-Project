LIBRARY IEEE;
USE IEEE.STD_LOGIC_1164.ALL;
USE IEEE.NUMERIC_STD.ALL;

ENTITY ElevatorTop IS
    PORT(
        CLOCK_50 : in  STD_LOGIC;
        KEY : in  STD_LOGIC_VECTOR(3 downto 0);
        SW : in  STD_LOGIC_VECTOR(9 downto 0); 
        HEX0 : out STD_LOGIC_VECTOR(6 downto 0);
        LEDR : out STD_LOGIC_VECTOR(9 downto 0)
    );
END ElevatorTop;

ARCHITECTURE Behavioral of ElevatorTop IS

    signal TickWire : std_logic;
    signal CurrFloorWire : integer range 0 to 4;
    signal DoorWire, UpWire, DownWire : std_logic;
    signal HardResetWire, SoftResetWire : std_logic;
    signal Debug : std_logic_vector(2 downto 0);

BEGIN
    HardResetWire <= not KEY(0);
    SoftResetWire <= not KEY(1);

    U1_CLK: entity work.ClockDivider
        generic map (MAX_COUNT => 50000000)
        port map (
            clk => CLOCK_50,
            reset => HardResetWire,
            tick => TickWire
        );

    -- Instantiate Controller
    U2_CTRL: entity work.elevator_controller
        port map (
            clk => CLOCK_50,
            HardReset => HardResetWire,
            SoftReset => SoftResetWire,
            estop => SW(9),
            tick => TickWire,
            ReqButtons => SW(3 downto 0), 
            CurrentFloor => CurrFloorWire,
            DoorOpen => DoorWire,
            MovingUp => UpWire,
            MovingDown => DownWire,
            debug => Debug
        );

    -- Instantiate Display
    U3_DISP: entity work.seven_segment
        port map (
            floor_in => current_floor_wire,
            hex_out => HEX0
        );
    
    -- System Status
    LEDR(0) <= door_wire; -- ON when Door is OPEN
    LEDR(1) <= up_wire;   -- ON when Moving UP
    LEDR(2) <= down_wire; -- ON when Moving DOWN
    
    -- Switch Input Debug (LEDR 3-6)
    -- This connects the switch directly to the LED so you can see it "register"
    LEDR(3) <= SW(0);     -- Floor 0 Request
    LEDR(4) <= SW(1);     -- Floor 1 Request
    LEDR(5) <= SW(2);     -- Floor 2 Request
    LEDR(6) <= SW(3);     -- Floor 3 Request
    
    -- Unused LEDs (Optional: Map debug state or force to 0)
    LEDR(7) <= '0';
    LEDR(8) <= '0';
    
    -- ESTOP Status
    LEDR(9) <= SW(9); 

END Behavioral;
